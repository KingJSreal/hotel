<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="kangjaesu.hotel.promotion.dao.mapper.PromotionMapper">
	<resultMap type="promotion" id="promotionMap">
		<id property="proNum" column="pro_num"/>
		<result property="proTitle" column="pro_title"/>
		<result property="proContent" column="pro_content"/>
		<result property="proStartDate" column="pro_start_date"/>
		<result property="proEndDate" column="pro_end_date"/>
		<result property="proDetail" column="pro_detail"/>
		<result property="proRegDate" column="pro_reg_date"/>
	</resultMap>
	
	<resultMap type="promotiondetail" id="prodMap">
		<id property="prodNum" column="prod_num"/>
		<result property="proNum" column="pro_num"/>
		<result property="prodTitle" column="prod_title"/>
		<result property="location" column="location"/>
		<result property="prodPic" column="prod_pic"/>
		<result property="serviceHour" column="service_hour"/>
		<result property="notice" column="notice"/>
		<result property="prodContent" column="prod_content"/>
	</resultMap>
	
	<select id="getPros" resultMap="prodMap">
		select *
		from promotions, pro_details
		where promotions.pro_num = pro_details.pro_num
		order by promotions.pro_num desc
	</select>
	
	<select id="getBoardPros" resultMap="promotionMap">
		select *
		from promotions
		order by pro_num desc
	</select>
	
	<select id="getPro" parameterType="int" resultType="promotion" resultMap="promotionMap">
		select *
		from promotions, pro_details
		where promotions.pro_num = pro_details.pro_num
		and promotions.pro_num = #{pro_num}
	</select>
	
	<insert id="addPro" parameterType="promotion">
		INSERT INTO promotions
			(pro_num, pro_title, pro_start_date, pro_end_date, pro_content, pro_reg_date)
		VALUES
			(promotion_seq.nextval, #{proTitle, jdbcType=VARCHAR}, #{proStartDate, jdbcType=DATE}, 
				#{proEndDate, jdbcType=DATE}, #{proContent, jdbcType=VARCHAR}, sysdate)
	</insert>
	<insert id="addProd" parameterType="promotiondetail">
		INSERT INTO pro_details
			(prod_num, pro_num, prod_title, location, service_hour, notice, prod_content)
		select
			pro_detail_seq.nextval, #{pro_num}, #{prodTitle, jdbcType=VARCHAR}, #{location, jdbcType=VARCHAR}, 
				#{serviceHour, jdbcType=VARCHAR}, #{notice, jdbcType=VARCHAR}, #{prodContent, jdbcType=VARCHAR}
		from promotions
		where pro_num = #{pro_num}
	</insert>
</mapper>