<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="kangjaesu.hotel.point.dao.mapper.PointMapper">
	<resultMap type="point" id="pointMap">
		<id property="pointNum" column="point_num"/>
		<result property="pointDate" column="point_date"/>
		<result property="pointContent" column="point_content"/>
		<result property="userNum" column="user_num" />
	</resultMap>
	
	<insert id="addPoint" parameterType="point" >
		insert into points values(POINT_SEQ.nextval, sysdate, #{pointContent}, #{userNum})
	</insert>
	
	<insert id="delPoint" parameterType="user">
		insert into points values(POINT_SEQ.nextval, sysdate, (
			select -sum(point_content)
			from users u LEFT OUTER JOIN points p
			   ON  u.user_num = p.user_num  
			where 1 = 1
	          and u.user_num = #{userNum}
		), #{userNum})
	</insert>
	
	<select id="getMyPointList" parameterType="user">
		select *
		from points
		where user_num = #{userNum}
	</select>
	
	<select id="getMyPointSum" parameterType="user">
		select sum(point_content)
		from points
		where user_num = #{userNum}
	</select>
</mapper>